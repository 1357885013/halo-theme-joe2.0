const encryption=str=>window.btoa(unescape(encodeURIComponent(str))),decrypt=str=>decodeURIComponent(escape(window.atob(str))),commonContext={initMode(){const $html=$("html"),$icon_light=$(".mode-light"),$icon_dark=$(".mode-dark");let local_theme="";if(ThemeConfig.static_theme)$html.attr("data-mode",ThemeConfig.static_theme);else if(ThemeConfig.enable_auto_switch_theme)if(local_theme=sessionStorage.getItem("data-mode"),localStorage.removeItem("data-mode"),local_theme)$html.attr("data-mode",local_theme),"light"===local_theme?($icon_light.removeClass("active"),$icon_dark.addClass("active")):($icon_light.addClass("active"),$icon_dark.removeClass("active"));else{const light_scope=ThemeConfig.dark_time_scope.split("~"),now=new Date,today=now.toLocaleString().split(" ")[0],theme=now>=new Date(today+" "+light_scope[0])&&now<=new Date(today+" "+light_scope[1])?"light":"dark";"light"===theme?($icon_light.removeClass("active"),$icon_dark.addClass("active")):($icon_light.addClass("active"),$icon_dark.removeClass("active")),$html.attr("data-mode",theme),sessionStorage.setItem("data-mode",theme)}else{const theme=localStorage.getItem("data-mode")||"light";$(".mode-"+("light"===theme?"dark":"light")).addClass("active"),$html.attr("data-mode",theme)}$(".joe_action_item.mode").on("click",(function(){const curSource=ThemeConfig.enable_auto_switch_theme?sessionStorage:localStorage;local_theme=curSource.getItem("data-mode");let theme="";local_theme?"light"===local_theme?(theme="dark",$icon_dark.removeClass("active"),$icon_light.addClass("active")):(theme="light",$icon_light.removeClass("active"),$icon_dark.addClass("active")):(theme="dark",$icon_light.removeClass("active"),$icon_dark.addClass("active")),$html.attr("data-mode",theme),curSource.setItem("data-mode",theme),commonContext.initCommentTheme()}))},initNavbar(){const $nav_menus=$(".joe_header__above-nav a"),$nav_side_menus=$(".panel-side-menu .link");let activeIndex=0;const curPath=location.pathname;curPath&&"/"!==curPath&&$nav_menus.each((index,item)=>{curPath.indexOf(item.getAttribute("href"))>-1&&(activeIndex=index)}),$nav_menus.eq(activeIndex).addClass("current"),$nav_side_menus.eq(activeIndex).addClass("current")},initCommentTheme(){const comments=document.getElementsByTagName("halo-comment"),curMode=$("html").attr("data-mode");for(let i=0;i<comments.length;i++){const shadowDom=comments[i].shadowRoot.getElementById("halo-comment");$(shadowDom)[`${"light"===curMode?"remove":"add"}Class`]("dark")}},initBaidu(){ThemeConfig.check_baidu_collect&&$("#joe_baidu_record").length&&$.ajax({url:ThemeConfig.BASE_URL+"/halo-api/bd/iscollect",type:"GET",dataType:"json",data:{url:window.location.href},success(res){if(res.data&&res.data.collected)$("#joe_baidu_record").css("color","#67c23a").html("已收录");else if(ThemeConfig.baidu_token){$("#joe_baidu_record").html('<span style="color: #e6a23c">未收录，推送中...</span>');const _timer=setTimeout((function(){$.ajax({url:ThemeConfig.BASE_URL+"/halo-api/bd/push",type:"POST",dataType:"json",data:{site:ThemeConfig.HOST,token:ThemeConfig.baidu_token,urls:window.location.href},success(res){0===res.data.success?$("#joe_baidu_record").html('<span style="color: #f56c6c">推送失败，请检查！</span>'):$("#joe_baidu_record").html('<span style="color: #67c23a">推送成功！</span>')}}),clearTimeout(_timer)}),1e3)}else{const url=`https://ziyuan.baidu.com/linksubmit/url?sitename=${encodeURI(window.location.href)}`;$("#joe_baidu_record").html(`<a target="_blank" href="${url}" rel="noopener noreferrer nofollow" style="color: #f56c6c">未收录，提交收录</a>`)}},error(err){console.log(err)}})},initMusic(){ThemeConfig.enabel_music_player&&$.ajax({url:`https://api.i-meto.com/meting/api?server=netease&type=playlist&id=${ThemeConfig.music_id}`,type:"GET",dataType:"json",success(res){new APlayer({container:document.getElementById("global-aplayer"),fixed:!0,lrcType:3,theme:"#1989fa",autoplay:!0,audio:res})},error(err){console.log(err)}})},initDynamicBg(){Joe.IS_MOBILE||"off"===Joe.DYNAMIC_BACKGROUND||!Joe.DYNAMIC_BACKGROUND||Joe.WALLPAPER_BACKGROUND_PC||$.getScript(window.Joe.THEME_URL+`assets/backdrop/${Joe.DYNAMIC_BACKGROUND}`)},setFavicon(){if(!ThemeConfig.favicon)return;const favicon=new Favico,image=new Image;image.onload=function(){favicon.image(image)},image.src=ThemeConfig.favicon},searchDialog(){$(".joe_header__above-search .input").on("click",(function(e){e.stopPropagation(),$(".joe_header__above-search .result").addClass("active")})),$(document).on("click",(function(){$(".joe_header__above-search .result").removeClass("active")}))},initDropMenu(){$(".joe_dropdown").each((function(index,item){const menu=$(this).find(".joe_dropdown__menu"),trigger=$(item).attr("trigger")||"click",placement=$(item).attr("placement")||$(this).height()||0;menu.css("top",placement),"hover"===trigger?$(this).hover(()=>$(this).addClass("active"),()=>$(this).removeClass("active")):($(this).on("click",(function(e){$(this).toggleClass("active"),$(document).one("click",()=>$(this).removeClass("active")),e.stopPropagation()})),menu.on("click",e=>e.stopPropagation()))}))},back2Top(){let _debounce=null;const handleScroll=()=>(document.documentElement.scrollTop||document.body.scrollTop)>300?$(".joe_action_item.scroll").addClass("active"):$(".joe_action_item.scroll").removeClass("active");handleScroll(),$(document).on("scroll",()=>{clearTimeout(_debounce),_debounce=setTimeout(handleScroll,80)}),$(".joe_action_item.scroll").on("click",()=>window.scrollTo({top:0,behavior:"smooth"}))},initTimeCount(){if(!$(".joe_aside__item.timelife").length)return;let timelife=[{title:"今日已经过去",endTitle:"小时",num:0,percent:"0%"},{title:"这周已经过去",endTitle:"天",num:0,percent:"0%"},{title:"本月已经过去",endTitle:"天",num:0,percent:"0%"},{title:"今年已经过去",endTitle:"个月",num:0,percent:"0%"}];{let todayPassHours=(+new Date-new Date((new Date).toLocaleDateString()).getTime())/1e3/60/60,todayPassHoursPercent=todayPassHours/24*100;timelife[0].num=parseInt(todayPassHours),timelife[0].percent=parseInt(todayPassHoursPercent)+"%"}{let weekDay={0:7,1:1,2:2,3:3,4:4,5:5,6:6}[(new Date).getDay()],weekDayPassPercent=weekDay/7*100;timelife[1].num=parseInt(weekDay),timelife[1].percent=parseInt(weekDayPassPercent)+"%"}{let year=(new Date).getFullYear(),date=(new Date).getDate(),month=(new Date).getMonth()+1,monthPassPercent=date/new Date(year,month,0).getDate()*100;timelife[2].num=date,timelife[2].percent=parseInt(monthPassPercent)+"%"}{let month=(new Date).getMonth()+1,yearPass=month/12*100;timelife[3].num=month,timelife[3].percent=parseInt(yearPass)+"%"}let htmlStr="";timelife.forEach((item,index)=>{htmlStr+=`\n\t\t\t\t\t\t<div class="item">\n\t\t\t\t\t\t\t<div class="title">\n\t\t\t\t\t\t\t\t${item.title}\n\t\t\t\t\t\t\t\t<span class="text">${item.num}</span>\n\t\t\t\t\t\t\t\t${item.endTitle}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="progress">\n\t\t\t\t\t\t\t\t<div class="progress-bar">\n\t\t\t\t\t\t\t\t\t<div class="progress-bar-inner progress-bar-inner-${index}" style="width: ${item.percent}"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="progress-percentage">${item.percent}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`}),$(".joe_aside__item.timelife .joe_aside__item-contain").html(htmlStr)},initWeather(){if(!$(".joe_aside__item.weather").length)return;const key=$(".joe_aside__item.weather").attr("data-key"),style=$(".joe_aside__item.weather").attr("data-style");window.WIDGET={CONFIG:{layout:2,width:"220",height:"270",background:style,dataColor:{1:"FFFFFF",2:"4A4A4A",3:"FFFFFF"}[style],language:"zh",key:key}},$.getScript("https://widget.qweather.net/standard/static/js/he-standard-common.js?v=2.0")},initGallery(){const $allImgs=$(".joe_detail__article img:not(img.owo_image), .joe_journal_block img");$allImgs.length&&$allImgs.each((function(){$(this).wrap($(`<span style="display: block;" data-fancybox="Joe" href="${$(this).attr("src")}"></span>`))}))},initExternalLink(){const $allLink=$(".page-post .joe_detail__article a[href], .joe_journal_body a[href]");$allLink.length&&$allLink.each((function(){$(this).attr({target:"_blank",rel:"noopener noreferrer nofollow"})}))},init3dTag(){if(!ThemeConfig.show_tag_cloud)return;const entries=[],colors=["#F8D800","#0396FF","#EA5455","#7367F0","#32CCBC","#F6416C","#28C76F","#9F44D3","#F55555","#736EFE","#E96D71","#DE4313","#D939CD","#4C83FF","#F072B6","#C346C2","#5961F9","#FD6585","#465EFB","#FFC600","#FA742B","#5151E5","#BB4E75","#FF52E5","#49C628","#00EAFF","#F067B4","#F067B4","#ff9a9e","#00f2fe","#4facfe","#f093fb","#6fa3ef","#bc99c4","#46c47c","#f9bb3c","#e8583d","#f68e5f"];$(".tags-cloud-list li").each((i,item)=>{var min,max;entries.push({label:$(item).attr("data-label"),url:$(item).attr("data-url"),target:"_blank",fontColor:colors[(min=0,max=colors.length-1,min=Math.ceil(min),max=Math.floor(max),Math.floor(Math.random()*(max-min+1))+min)],fontSize:15})}),$("#tags-3d").svg3DTagCloud({entries:entries,width:250,height:250,radius:"65%",radiusMin:75,bgDraw:!1,fov:800,speed:.5,fontWeight:500}),$(".tags-cloud-list").remove()},initLive2d(){ThemeConfig.enable_live2d&&$.getScript("https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.min.js",()=>{L2Dwidget.init({model:{jsonPath:Joe.LIVE2D,scale:1},mobile:{show:!1},display:{position:"right",width:160,height:200,hOffset:70,vOffset:0}})})},offscreenTip(){if(!ThemeConfig.enable_offscreen_tip)return;const OriginTitile=document.title;let timer=null;document.addEventListener("visibilitychange",(function(){location.href.indexOf(ThemeConfig.blog_url)>0||"/"!==location.pathname||(document.hidden?(document.title=ThemeConfig.offscreen_title_leave||"歪，你去哪里了？",clearTimeout(timer)):(document.title=ThemeConfig.offscreen_title_back||"(つェ⊂)咦，又回来了!",timer=setTimeout((function(){document.title=OriginTitile}),2e3)))}))},drawerMobile(){$(".joe_header__above-slideicon").on("click",(function(){$(".joe_header__searchout").removeClass("active"),$(".joe_header__slideout").hasClass("active")?($("body").css("overflow",""),$(".joe_header__mask").removeClass("active slideout"),$(".joe_header__slideout").removeClass("active")):($("body").css("overflow","hidden"),$(".joe_header__mask").addClass("active slideout"),$(".joe_header__slideout").addClass("active"))}))},searchMobile(){$(".joe_header__above-searchicon").on("click",(function(){$(".joe_header__slideout").removeClass("active"),$(".joe_header__searchout").hasClass("active")?($("body").css("overflow",""),$(".joe_header__mask").removeClass("active slideout"),$(".joe_header__searchout").removeClass("active")):($("body").css("overflow","hidden"),$(".joe_header__mask").addClass("active"),$(".joe_header__searchout").addClass("active"))}))},maskClose(){$(".joe_header__mask").on("click",(function(){$("body").css("overflow",""),$(".joe_header__mask").removeClass("active slideout"),$(".joe_header__searchout").removeClass("active"),$(".joe_header__slideout").removeClass("active")}))},sideMenuMobile(){$(".joe_header__slideout-menu .current").parents(".panel-body").show().siblings(".panel").addClass("in"),$(".joe_header__slideout-menu .panel").on("click",(function(){const panelBox=$(this).parent().parent();panelBox.find(".panel").not($(this)).removeClass("in"),panelBox.find(".panel-body").not($(this).siblings(".panel-body")).stop().hide("fast"),$(this).toggleClass("in").siblings(".panel-body").stop().toggle("fast")}))},initRuntime(){if(!ThemeConfig.birthday||!/(\d{4})\/(\d{1,2})\/(\d{1,2}) (\d{1,2})\:(\d{1,2})\:(\d{1,2})/.test(ThemeConfig.birthday))return;const getRunTime=()=>{const birthDay=new Date(ThemeConfig.birthday);let day=(+new Date-birthDay.getTime())/864e5,dayPast=Math.floor(day),hour=24*(day-dayPast),hourPast=Math.floor(hour),minute=60*(hour-hourPast),minutePast=Math.floor(minute),second=60*(minute-minutePast),secondPast=Math.floor(second);day=String(dayPast).padStart(2,0),hour=String(hourPast).padStart(2,0),minute=String(minutePast).padStart(2,0),second=String(secondPast).padStart(2,0),$(".joe_run__day").html(day),$(".joe_run__hour").html(hour),$(".joe_run__minute").html(minute),$(".joe_run__second").html(second)};getRunTime(),setInterval(getRunTime,1e3)},initEmoji(){($(".joe_owo__contain").length||$(".joe_owo__target").length)&&$.ajax({url:window.Joe.THEME_URL+"assets/json/joe.owo.json",dataType:"json",success(res){let barStr="",scrollStr="";for(let key in res){const item=res[key];barStr+=`<div class="item" data-type="${key}">${key}</div>`,scrollStr+=`\n                            <ul class="scroll" data-type="${key}">\n\t\t\t\t\t\t\t\t${item.map(_=>`<li class="item" data-text="${_.data}">${"颜文字"===key?`${_.icon}`:`<img src="${window.Joe.THEME_URL+_.icon}" alt="${_.data}"/>`}</li>`).join("")}\n                            </ul>\n                        `}$(".joe_owo__contain").html(`\n                        <div class="seat">OωO</div>\n                        <div class="box">\n                            ${scrollStr}\n                            <div class="bar">${barStr}</div>\n                        </div>\n                    `),$(document).on("click",(function(){$(".joe_owo__contain .box").stop().slideUp("fast")})),$(".joe_owo__contain .seat").on("click",(function(e){e.stopPropagation(),$(this).siblings(".box").stop().slideToggle("fast")})),$(".joe_owo__contain .box .bar .item").on("click",(function(e){e.stopPropagation(),$(this).addClass("active").siblings().removeClass("active");const scrollIndx='.joe_owo__contain .box .scroll[data-type="'+$(this).attr("data-type")+'"]';$(scrollIndx).show().siblings(".scroll").hide()})),$(".joe_owo__contain .scroll .item").on("click",(function(){const text=$(this).attr("data-text");$(".joe_owo__target").insertContent(text)})),$(".joe_owo__contain .box .bar .item").first().click()}})},initHeadScroll(){if(window.Joe.IS_MOBILE)return;let flag=!0;const handleHeader=diffY=>{if(window.pageYOffset>=$(".joe_header").height()&&diffY<=0){if(flag)return;$(".joe_header").addClass("active"),$(".joe_aside .joe_aside__item:last-child").css("top",$(".joe_header").height()-60+15),flag=!0}else{if(!flag)return;$(".joe_header").removeClass("active"),$(".joe_aside .joe_aside__item:last-child").css("top",$(".joe_header").height()+15),flag=!1}};let Y=window.pageYOffset;handleHeader(Y);let _last=Date.now();document.addEventListener("scroll",()=>{let _now=Date.now();_now-_last>15&&(handleHeader(Y-window.pageYOffset),Y=window.pageYOffset),_last=_now})},scrollToHash(){const scroll=new URLSearchParams(location.search).get("scroll");if(scroll){const height=$(".joe_header").height();let elementEL=null;if(elementEL=$("#"+scroll).length>0?$("#"+scroll):$("."+scroll),elementEL&&elementEL.length>0){const top=elementEL.offset().top-height-15;window.scrollTo({top:top,behavior:"smooth"})}}}};var omits=["init3dTag"];document.addEventListener("DOMContentLoaded",(function(){Object.keys(commonContext).forEach(c=>!omits.includes(c)&&commonContext[c]())})),window.addEventListener("load",(function(){1===omits.length?commonContext[omits[0]]():omits.forEach(c=>commonContext[c]())}));