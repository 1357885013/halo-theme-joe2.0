const journalContext={initEffect(){ThemeConfig.enable_journal_effect&&new WOW({boxClass:"wow",animateClass:"fadeIn",offset:0,mobile:!0,live:!0}).init()},initLike(){if(!ThemeConfig.enable_like_journal)return;const $allItems=$(".joe_journal__item");$allItems.length&&$allItems.each((function(_,item){const $this=$(this),cid=$this.attr("data-cid"),clikes=+($this.attr("data-clikes")||0);let agreeArr=localStorage.getItem(encryption("agree-journal"))?JSON.parse(decrypt(localStorage.getItem(encryption("agree-journal")))):[];const $iconLike=$this.find(".journal-like"),$iconUnlike=$this.find(".journal-unlike"),$likeNum=$this.find(".journal-likes-num");agreeArr.includes(cid)?($iconLike.hide(),$iconUnlike.show()):($iconLike.show(),$iconUnlike.hide()),$likeNum.html(clikes),$iconLike.on("click",(function(){let _loading=!1;if(_loading)return;_loading=!0,agreeArr=localStorage.getItem(encryption("agree-journal"))?JSON.parse(decrypt(localStorage.getItem(encryption("agree-journal")))):[];let flag=agreeArr.includes(cid);$.ajax({url:"/api/content/journals/"+cid+"/likes",type:"POST",dataType:"json",data:{type:flag?"disagree":"agree"},success(res){if(200!==res.status)return;let likes=clikes;if(flag){likes--;const index=agreeArr.findIndex(_=>_===cid);agreeArr.splice(index,1),$iconLike.show(),$iconUnlike.hide()}else likes++,agreeArr.push(cid),$iconLike.hide(),$iconUnlike.show();const name=encryption("agree-journal"),val=encryption(JSON.stringify(agreeArr));localStorage.setItem(name,val),$likeNum.html(likes)},error:err=>(_loading=!1,Qmsg.warning(err.responseJSON.message)),complete(){_loading=!1}})}))}))},initComment(){!ThemeConfig.enable_clean_mode&&ThemeConfig.enable_comment_journal&&$(".journal_comment_expander,.journal-comment").on("click",(function(){const $parent=$(this).parents(".footer-wrap"),compComment=$parent.find("halo-comment")[0]._wrapper.$refs.inner;$parent.hasClass("open")||compComment.loadComments(),$parent.toggleClass("open"),$parent.find(".journal_comment_expander_txt").html(($parent.hasClass("open")?"收起":"查看")+"评论")}))},initExpander(){$(".journal_content_expander i").on("click",(function(){$(this).parents(".joe_journal_body").toggleClass("open")}))},initCode(){$("pre[class*='language-']").length&&$("pre[class*='language-']").each((function(index,item){const $item=$(item),expander=$('<i class="joe-font joe-icon-arrow-downb code-expander" title="折叠/展开"></i>');expander.on("click",(function(){const $auto_fold=expander.parent("pre").siblings(".toolbar").find(".autofold-tip");$auto_fold&&$auto_fold.remove(),expander.parent("pre").toggleClass("close")})),$item.prepend(expander);const text=$(item).find("code[class*='language-']").text(),span=$('<span class="copy-button"><i class="joe-font joe-icon-copy" title="复制代码"></i></span>');new ClipboardJS(span[0],{text:()=>text}).on("success",()=>Qmsg.success("复制成功！")),$(item).addClass("copyable").append(span)}))},foldBlock(){$(".joe_journal_body .content-wrp").each((function(){const $this=$(this);$this[0].getBoundingClientRect().height>270&&$this.siblings(".journal_content_expander").show()}))},formatTime(){$(".joe_journal-posttime").each((function(){const $this=$(this);$this.html(Utils.timeAgo($this.text()))}))}};!function(){const omits=["formatTime","foldBlock"];document.addEventListener("DOMContentLoaded",(function(){Object.keys(journalContext).forEach(c=>!omits.includes(c)&&journalContext[c]())})),window.addEventListener("load",(function(){journalContext.foldBlock()}))}();