const encryption=str=>window.btoa(unescape(encodeURIComponent(str))),decrypt=str=>decodeURIComponent(escape(window.atob(str))),JoeContext={initToc(){ThemeConfig.enable_toc&&$(".toc-container").length&&(document.body.clientWidth<=1200||(tocbot.init({tocSelector:"#js-toc",contentSelector:".joe_detail__article",ignoreSelector:".js-toc-ignore",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:ThemeConfig.tocDepth||0,hasInnerContainers:!1,headingsOffset:-80,scrollSmoothOffset:-70,positionFixedSelector:".toc-container",positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto"}),$(".toc-container").show(),$(".toc-expander i").on("click",(function(){$(this).parents(".toc-container").toggleClass("hide")}))))},initCopy(){if(!ThemeConfig.enable_copy||!$(".joe_post").length)return;const curl=$(".joe_detail").attr("data-curl");$(".joe_post .joe_detail").on("copy",(function(e){const body_element=document.body,selection=window.getSelection(),appendLink=`作者：${ThemeConfig.author}<br>\n          链接：${curl}<br>\n          来源：${ThemeConfig.blog_title}<br>\n          著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。`;if(window.clipboardData){const copytext=selection+"\r\n\r\n"+appendLink;return window.clipboardData.setData("Text",copytext),!1}{const copytext=selection+"<br><br>"+appendLink,newdiv=document.createElement("div");newdiv.style.position="absolute",newdiv.style.left="-99999px",body_element.appendChild(newdiv),newdiv.innerHTML=copytext,selection.selectAllChildren(newdiv),setTimeout((function(){body_element.removeChild(newdiv)}),0)}}))},initBaidu(){ThemeConfig.check_baidu_collect&&$("#joe_baidu_record").length&&$.ajax({url:ThemeConfig.BASE_URL+"/halo-api/bd/iscollect",type:"GET",dataType:"json",data:{url:window.location.href},success(res){if(res.data&&res.data.collected)$("#joe_baidu_record").css("color","#67c23a").html("已收录");else if(ThemeConfig.baidu_token){$("#joe_baidu_record").html('<span style="color: #e6a23c">未收录，推送中...</span>');const _timer=setTimeout((function(){$.ajax({url:ThemeConfig.BASE_URL+"/halo-api/bd/push",type:"POST",dataType:"json",data:{site:ThemeConfig.HOST,token:ThemeConfig.baidu_token,urls:window.location.href},success(res){0===res.data.success?$("#joe_baidu_record").html('<span style="color: #f56c6c">推送失败，请检查！</span>'):$("#joe_baidu_record").html('<span style="color: #67c23a">推送成功！</span>')}}),clearTimeout(_timer)}),1e3)}else{const url=`https://ziyuan.baidu.com/linksubmit/url?sitename=${encodeURI(window.location.href)}`;$("#joe_baidu_record").html(`<a target="_blank" href="${url}" rel="noopener noreferrer nofollow" style="color: #f56c6c">未收录，提交收录</a>`)}},error(err){console.log(err)}})},initCode(){(ThemeConfig.enable_code_expander||ThemeConfig.enable_code_copy)&&$("pre[class*='language-']").length&&$("pre[class*='language-']").each((function(index,item){if(ThemeConfig.enable_code_expander){const $item=$(item),expander=$('<i class="joe-font joe-icon-arrow-downb code-expander" title="折叠/展开"></i>');if(expander.on("click",(function(){const $auto_fold=expander.parent("pre").siblings(".toolbar").find(".autofold-tip");$auto_fold&&$auto_fold.remove(),expander.parent("pre").toggleClass("close")})),$item.prepend(expander),ThemeConfig.fold_long_code&&location.pathname.includes("archives")&&$item.height()>(ThemeConfig.long_code_height||200)){$item.siblings(".toolbar").find(".toolbar-item span").eq(0).append('<em class="autofold-tip"><内容过长，已自动折叠></em>'),$item.addClass("close")}}if(ThemeConfig.enable_code_copy){const text=$(item).find("code[class*='language-']").text(),span=$('<span class="copy-button"><i class="joe-font joe-icon-copy" title="复制代码"></i></span>');new ClipboardJS(span[0],{text:()=>text+"\r\n\r\n"+ThemeConfig.copy_right_text}).on("success",()=>Qmsg.success("复制成功！")),$(item).addClass("copyable").append(span)}}))},initAside(){ThemeConfig.enable_post_aside&&ThemeConfig.enable_aside_expander&&$(".aside-expander").on("click",(function(){const $this=$(this);$this.hasClass("active")?($this.removeClass("active"),$this.html("隐藏侧边栏")):($this.addClass("active"),$this.html("显示侧边栏")),$(".joe_aside").toggleClass("hide")}))},initGallery(){$(".joe_detail__article img:not(img.owo_image), .joe_journal_block img").each((function(){$(this).wrap($(`<span style="display: block;" data-fancybox="Joe" href="${$(this).attr("src")}"></span>`))}))},initPostShare(){ThemeConfig.enable_share&&(ThemeConfig.enable_share_link&&$(".icon-share-link").length&&new ClipboardJS($(".icon-share-link")[0],{text:()=>location.href}).on("success",()=>Qmsg.success("文章链接已复制")),ThemeConfig.enable_share_weixin&&$("#qrcode_wx").length&&$("#qrcode_wx").qrcode({width:140,height:140,render:"canvas",typeNumber:-1,correctLevel:0,background:"#ffffff",foreground:"#000000",text:location.href}))},initExternalLink(){$(".joe_detail__article a:not(.joe_detail__article-anote)").each((function(){$(this).attr({target:"_blank",rel:"noopener noreferrer nofollow"})}))},initLike(){if(!ThemeConfig.enable_like||!$(".joe_detail__agree").length)return;const cid=$(".joe_detail").attr("data-cid"),clikes=+($(".joe_detail").attr("data-clikes")||0);let agreeArr=localStorage.getItem(encryption("agree"))?JSON.parse(decrypt(localStorage.getItem(encryption("agree")))):[];const $icons=$(".joe_detail__agree .icon"),$iconLike=$(".joe_detail__agree .icon-like"),$iconUnlike=$(".joe_detail__agree .icon-unlike"),$likeNum=$(".joe_detail__agree .text");agreeArr.includes(cid)?$iconUnlike.addClass("active"):$iconLike.addClass("active"),$likeNum.html(clikes);let _loading=!1;$iconLike.on("click",(function(){if(_loading)return;_loading=!0,agreeArr=localStorage.getItem(encryption("agree"))?JSON.parse(decrypt(localStorage.getItem(encryption("agree")))):[];let flag=agreeArr.includes(cid);$.ajax({url:"/api/content/posts/"+cid+"/likes",type:"POST",dataType:"json",data:{type:flag?"disagree":"agree"},success(res){if(200!==res.status)return;let likes=clikes;if(flag){likes--;const index=agreeArr.findIndex(_=>_===cid);agreeArr.splice(index,1),$iconUnlike.removeClass("active"),$iconLike.addClass("active"),$icons.removeClass("active")}else likes++,agreeArr.push(cid),$iconLike.removeClass("active"),$iconUnlike.addClass("active"),$icons.addClass("active");const name=encryption("agree"),val=encryption(JSON.stringify(agreeArr));localStorage.setItem(name,val),$likeNum.html(likes)},error:err=>(_loading=!1,Qmsg.warning(err.responseJSON.message)),complete(){_loading=!1}})}))},initVideo(){if($(".joe_detail__article-video").length){const player=$(".joe_detail__article-video .play iframe").attr("data-player");$(".joe_detail__article-video .episodes .item").on("click",(function(){$(this).addClass("active").siblings().removeClass("active");const url=$(this).attr("data-src");$(".joe_detail__article-video .play iframe").attr({src:player+url})})),$(".joe_detail__article-video .episodes .item").first().click()}},initJournals(){if($(".journal_content_expander i").on("click",(function(){$(this).parents(".joe_journal_body").toggleClass("open")})),ThemeConfig.enable_like_journal){const $allItems=$(".joe_journal__item");$allItems.length&&$allItems.each((function(_,item){const $this=$(this),cid=$this.attr("data-cid"),clikes=+($this.attr("data-clikes")||0);let agreeArr=localStorage.getItem(encryption("agree-journal"))?JSON.parse(decrypt(localStorage.getItem(encryption("agree-journal")))):[];const $iconLike=$this.find(".journal-like"),$iconUnlike=$this.find(".journal-unlike"),$likeNum=$this.find(".journal-likes-num");agreeArr.includes(cid)?($iconLike.hide(),$iconUnlike.show()):($iconLike.show(),$iconUnlike.hide()),$likeNum.html(clikes),$iconLike.on("click",(function(){let _loading=!1;if(_loading)return;_loading=!0,agreeArr=localStorage.getItem(encryption("agree-journal"))?JSON.parse(decrypt(localStorage.getItem(encryption("agree-journal")))):[];let flag=agreeArr.includes(cid);$.ajax({url:"/api/content/journals/"+cid+"/likes",type:"POST",dataType:"json",data:{type:flag?"disagree":"agree"},success(res){if(200!==res.status)return;let likes=clikes;if(flag){likes--;const index=agreeArr.findIndex(_=>_===cid);agreeArr.splice(index,1),$iconLike.show(),$iconUnlike.hide()}else likes++,agreeArr.push(cid),$iconLike.hide(),$iconUnlike.show();const name=encryption("agree-journal"),val=encryption(JSON.stringify(agreeArr));localStorage.setItem(name,val),$likeNum.html(likes)},error:err=>(_loading=!1,Qmsg.warning(err.responseJSON.message)),complete(){_loading=!1}})}))}))}ThemeConfig.enable_comment_journal&&$(".journal_comment_expander,.journal-comment").on("click",(function(){const $parent=$(this).parents(".footer-wrap");if(ThemeConfig.enable_autoload_comment_journal){const compComment=$parent.find("halo-comment")[0].shadowRoot.getElementById("halo-comment").__vue__;$parent.hasClass("open")||compComment.loaded||compComment.loadComments()}$parent.toggleClass("open"),$parent.find(".journal_comment_expander_txt").html(($parent.hasClass("open")?"收起":"查看")+"评论")}))},initMathjax(){ThemeConfig.enable_mathjax&&window.katex&&renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})}};document.addEventListener("DOMContentLoaded",()=>{if(Object.keys(JoeContext).forEach(item=>JoeContext[item]()),ThemeConfig.show_tag_cloud){const entries=[],colors=["#F8D800","#0396FF","#EA5455","#7367F0","#32CCBC","#F6416C","#28C76F","#9F44D3","#F55555","#736EFE","#E96D71","#DE4313","#D939CD","#4C83FF","#F072B6","#C346C2","#5961F9","#FD6585","#465EFB","#FFC600","#FA742B","#5151E5","#BB4E75","#FF52E5","#49C628","#00EAFF","#F067B4","#F067B4","#ff9a9e","#00f2fe","#4facfe","#f093fb","#6fa3ef","#bc99c4","#46c47c","#f9bb3c","#e8583d","#f68e5f"],random=(min,max)=>(min=Math.ceil(min),max=Math.floor(max),Math.floor(Math.random()*(max-min+1))+min);$(".tags-cloud-list li").each((i,item)=>{entries.push({label:$(item).attr("data-label"),url:$(item).attr("data-url"),target:"_blank",fontColor:colors[random(0,colors.length-1)],fontSize:15})}),$("#tags-3d").svg3DTagCloud({entries:entries,width:250,height:250,radius:"65%",radiusMin:75,bgDraw:!1,fov:800,speed:.5,fontWeight:500}),$(".tags-cloud-list").remove()}}),window.addEventListener("load",(function(){{const scroll=new URLSearchParams(location.search).get("scroll");if(scroll){const height=$(".joe_header").height();let elementEL=null;if(elementEL=$("#"+scroll).length>0?$("#"+scroll):$("."+scroll),elementEL&&elementEL.length>0){const top=elementEL.offset().top-height-15;window.scrollTo({top:top,behavior:"smooth"})}}}$(".joe_journal_body .content-wrp").each((function(){$(this)[0].getBoundingClientRect().height>270&&$(this).siblings(".journal_content_expander").show()}))}));