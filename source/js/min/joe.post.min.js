const postContext={initToc(){ThemeConfig.enable_toc&&$(".toc-container").length&&(document.body.clientWidth<=1200||(tocbot.init({tocSelector:"#js-toc",contentSelector:".joe_detail__article",ignoreSelector:".js-toc-ignore",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:ThemeConfig.toc_depth||0,hasInnerContainers:!1,headingsOffset:-80,scrollSmoothOffset:-70,positionFixedSelector:".toc-container",positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto"}),$("#js-toc").children().length||($("#js-toc").html('<div class="toc-nodata">暂无目录</div>'),$(".toc-container").addClass("hide")),$(".toc-container").show(),$(".toc-expander i").on("click",(function(){$(this).parents(".toc-container").toggleClass("hide")}))))},initProgress(){if(!ThemeConfig.enable_progress_bar)return;$(window).off("scroll");const progress_bar=$(".joe_progress_bar");let win_h,body_h,sHeight;$(window).on("scroll",(function(){win_h=$(window).height(),body_h=$("body").height(),sHeight=body_h-win_h,window.requestAnimationFrame((function(){const perc=Math.max(0,Math.min(1,$(window).scrollTop()/sHeight));var p;p=perc,progress_bar.css("width",100*p+"%")}))}))},initCopy(){if(!ThemeConfig.enable_copy)return;const curl=$(".joe_detail").attr("data-curl")||location.href;$(".joe_detail__article").on("copy",(function(e){const body_element=document.body,selection=window.getSelection(),appendLink=ThemeConfig.enable_copy_right_text?ThemeConfig.copy_right_text||`\r\n\r\n====================================<br>\n          作者：${ThemeConfig.author}<br>\n          来源：${ThemeConfig.blog_title}<br>\n          链接：${curl}<br>\n          版权声明：内容遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。`:"";if(window.clipboardData){const copytext=selection+appendLink;return window.clipboardData.setData("Text",copytext),!1}{const copytext=selection+appendLink,newdiv=document.createElement("div");newdiv.style.position="absolute",newdiv.style.left="-99999px",body_element.appendChild(newdiv),newdiv.innerHTML=copytext,selection.selectAllChildren(newdiv),setTimeout((function(){body_element.removeChild(newdiv)}),0)}}))},initCode(){(ThemeConfig.enable_code_expander||ThemeConfig.enable_code_copy)&&$("pre[class*='language-']").length&&$("pre[class*='language-']").each((function(index,item){if(ThemeConfig.enable_code_expander){const $item=$(item),expander=$('<i class="joe-font joe-icon-arrow-downb code-expander" title="折叠/展开"></i>');expander.on("click",(function(){const $auto_fold=expander.parent("pre").siblings(".toolbar").find(".autofold-tip");$auto_fold&&$auto_fold.remove(),expander.parent("pre").toggleClass("close")})),$item.prepend(expander)}if(ThemeConfig.enable_code_copy){const text=$(item).find("code[class*='language-']").text(),span=$('<span class="copy-button"><i class="joe-font joe-icon-copy" title="复制代码"></i></span>');new ClipboardJS(span[0],{text:()=>text}).on("success",()=>Qmsg.success("复制成功！")),$(item).addClass("copyable").append(span)}}))},foldCode(){ThemeConfig.enable_code_expander&&ThemeConfig.fold_long_code&&$("pre[class*='language-']").each((function(index,item){const $item=$(item);if($item.height()>200){$item.siblings(".toolbar").find(".toolbar-item span").eq(0).append('<em class="autofold-tip"><内容过长，已自动折叠></em>'),$item.addClass("close")}}))},initAside(){ThemeConfig.enable_post_aside&&ThemeConfig.enable_aside_expander&&$(".aside-expander").on("click",(function(){const $this=$(this);$this.hasClass("active")?($this.removeClass("active"),$this.html("隐藏侧边栏")):($this.addClass("active"),$this.html("显示侧边栏")),$(".joe_aside").toggleClass("hide")}))},initShare(){ThemeConfig.enable_share&&(ThemeConfig.enable_share_link&&$(".icon-share-link").length&&new ClipboardJS($(".icon-share-link")[0],{text:()=>location.href}).on("success",()=>Qmsg.success("文章链接已复制")),ThemeConfig.enable_share_weixin&&$("#qrcode_wx").length&&$("#qrcode_wx").qrcode({width:140,height:140,render:"canvas",typeNumber:-1,correctLevel:0,background:"#ffffff",foreground:"#000000",text:location.href}))},initLike(){if(!ThemeConfig.enable_like||!$(".joe_detail__agree").length)return;const cid=$(".joe_detail").attr("data-cid"),clikes=+($(".joe_detail").attr("data-clikes")||0);let agreeArr=localStorage.getItem(encryption("agree"))?JSON.parse(decrypt(localStorage.getItem(encryption("agree")))):[];const $icons=$(".joe_detail__agree .icon"),$iconLike=$(".joe_detail__agree .icon-like"),$iconUnlike=$(".joe_detail__agree .icon-unlike"),$likeNum=$(".joe_detail__agree .text");agreeArr.includes(cid)?$iconUnlike.addClass("active"):$iconLike.addClass("active"),$likeNum.html(clikes);let _loading=!1;$iconLike.on("click",(function(){if(_loading)return;_loading=!0,agreeArr=localStorage.getItem(encryption("agree"))?JSON.parse(decrypt(localStorage.getItem(encryption("agree")))):[];let flag=agreeArr.includes(cid);$.ajax({url:"/api/content/posts/"+cid+"/likes",type:"POST",dataType:"json",data:{type:flag?"disagree":"agree"},success(res){if(200!==res.status)return;let likes=clikes;if(flag){likes--;const index=agreeArr.findIndex(_=>_===cid);agreeArr.splice(index,1),$iconUnlike.removeClass("active"),$iconLike.addClass("active"),$icons.removeClass("active")}else likes++,agreeArr.push(cid),$iconLike.removeClass("active"),$iconUnlike.addClass("active"),$icons.addClass("active");const name=encryption("agree"),val=encryption(JSON.stringify(agreeArr));localStorage.setItem(name,val),$likeNum.html(likes)},error:err=>(_loading=!1,Qmsg.warning(err.responseJSON.message)),complete(){_loading=!1}})}))},initVideo(){if($(".joe_detail__article-video").length){const player=$(".joe_detail__article-video .play iframe").attr("data-player");$(".joe_detail__article-video .episodes .item").on("click",(function(){$(this).addClass("active").siblings().removeClass("active");const url=$(this).attr("data-src");$(".joe_detail__article-video .play iframe").attr({src:player+url})})),$(".joe_detail__article-video .episodes .item").first().click()}},initMathjax(){ThemeConfig.enable_mathjax&&window.katex&&renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})}};!function(){const omits=["initToc","foldCode"];document.addEventListener("DOMContentLoaded",(function(){Object.keys(postContext).forEach(c=>!omits.includes(c)&&postContext[c]())})),window.addEventListener("load",(function(){1===omits.length?postContext[omits[0]]():omits.forEach(c=>postContext[c]())}))}();