(()=>{var r=null,t={initReadLimit:function(){var o,e,t,n,a=$(".page-post .joe_detail__article"),i=$("joe-hide");i.length&&(o=$(".joe_detail").attr("data-cid"),1<i.length&&((e=i.eq(i.length-1)).addClass("marker"),i=e,$("joe-hide:not(.marker)").parent().remove()),a.attr("data-partial","true"),n=function(){var e=localStorage.getItem("partialIds"),t=i.offset().top;r.replaceAll(i.parent()),localStorage.setItem("partialIds",e?e+","+o:o),r=null,commonContext.initCode(!0),commonContext.initGallery(),commonContext.initPDF(),tocbot.refresh(),window.scrollTo({top:t-150})},(t=function(e,t){var o=localStorage.getItem("partialIds");o&&o.includes(e)?$("joe-hide").parent().remove():t&&t(e)})(o,function(){var e=i.parent().nextAll();(r=e).remove(),document.getElementsByTagName("halo-comment")[0].addEventListener("post-success",function(e){t(o,n)})})),a.addClass("show")},initCopy:function(){var r,c;"false"!==PageAttrs.metas.enable_copy&&ThemeConfig.enable_copy&&(r=location.href,c=$(".joe_detail").attr("data-author"),$(".joe_detail__article").on("copy",function(e){var t=window.getSelection(),o=t.toString().replace(/<已自动折叠>/g,""),n=ThemeConfig.enable_copy_right_text?ThemeConfig.copy_right_text||"\r\n\r\n====================================<br>作者：".concat(c,"<br>来源：").concat(ThemeConfig.blog_title,"<br>链接：").concat(r,"<br>版权声明：内容遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。"):"";if(window.clipboardData)return window.clipboardData.setData("Text",o+n),!1;var a=document.body,o=o+n,i=document.createElement("pre");i.style.position="absolute",i.style.left="-99999px",a.appendChild(i),i.innerHTML=o,t.selectAllChildren(i),setTimeout(function(){a.removeChild(i)},0)}))},initShare:function(){"false"!==PageAttrs.metas.enable_share&&ThemeConfig.enable_share&&(ThemeConfig.enable_share_link&&$(".icon-share-link").length&&$(".icon-share-link").each(function(e,t){new ClipboardJS($(t)[0],{text:function(){return location.href}}).on("success",function(){return Qmsg.success("文章链接已复制")})}),ThemeConfig.enable_share_weixin&&$(".qrcode_wx").length&&$(".qrcode_wx").qrcode({width:140,height:140,render:"canvas",typeNumber:-1,correctLevel:0,background:"#ffffff",foreground:"#000000",text:location.href}))},initLike:function(){var a,i,r,c,l,s,d,m,t;"false"!==PageAttrs.metas.enable_like&&ThemeConfig.enable_like&&$(".joe_detail__agree").length&&(a=$(".joe_detail").attr("data-cid"),i=+($(".joe_detail").attr("data-clikes")||0),r=localStorage.getItem(encryption("agree"))?JSON.parse(decrypt(localStorage.getItem(encryption("agree")))):[],c=r.includes(a),l=$(".joe_detail__agree, .post-operate-like"),s=l.find(".icon-like"),d=l.find(".icon-unlike"),m=l.find(".nums"),(c?d:s).addClass("active"),m.html(i),t=!1,s.on("click",function(e){e.stopPropagation(),t||(t=!0,r=localStorage.getItem(encryption("agree"))?JSON.parse(decrypt(localStorage.getItem(encryption("agree")))):[],c=r.includes(a),Utils.request("/api/content/posts/"+a+"/likes","POST",{type:c?"disagree":"agree"}).then(function(e){var t=i,o=(c?(t--,o=r.findIndex(function(e){return e===a}),r.splice(o,1),d.removeClass("active"),s.addClass("active"),l.removeClass("active")):(t++,r.push(a),s.removeClass("active"),d.addClass("active"),l.addClass("active")),encryption("agree")),n=encryption(JSON.stringify(r));localStorage.setItem(o,n),m.html(t).show()}).catch(function(e){t=!1}))}))},initToc:function(){"false"!==PageAttrs.metas.enable_toc&&ThemeConfig.enable_toc&&$(".toc-container").length&&(document.body.clientWidth<=992||(tocbot.init({tocSelector:"#js-toc",contentSelector:".joe_detail__article",ignoreSelector:".js-toc-ignore",headingSelector:"h1, h2, h3, h4, h5, h6",collapseDepth:+(PageAttrs.metas.toc_depth||ThemeConfig.toc_depth||0),hasInnerContainers:!1,headingsOffset:80,scrollSmoothOffset:-80,positionFixedSelector:".toc-container",positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto",onClick:function(e){window.tocPhase=!0},scrollEndCallback:function(e){window.tocPhase=null}}),$("#js-toc").children().length||$("#js-toc").html('<div class="toc-nodata">暂无目录</div>'),$(".toc-container").show()))},initAsideOperate:function(){$(".post-operate-comment").on("click",function(e){var t=document.querySelector(".joe_comment"),o=document.querySelector(".joe_header");t&&o&&(e.stopPropagation(),document.getElementsByTagName("halo-comment").length?(e=t.offsetTop-o.offsetHeight-15,window.scrollTo({top:e})):Qmsg.warning("评论功能不可用！"))})},initProgress:function(){var t,o,n,a;ThemeConfig.enable_progress_bar&&($(window).off("scroll"),a=$(".joe_progress_bar"),$(window).on("scroll",function(e){e.stopPropagation(),t=$(window).height(),o=$("body").height(),n=o-t,window.requestAnimationFrame(function(){var e=Math.max(0,Math.min(1,$(window).scrollTop()/n));a.css("width",100*e+"%")})}))},initVideo:function(){var t;$(".joe_detail__article-video").length&&(t=$(".joe_detail__article-video .play iframe").attr("data-player"),$(".joe_detail__article-video .episodes .item").on("click",function(e){e.stopPropagation(),$(this).addClass("active").siblings().removeClass("active");e=$(this).attr("data-src");$(".joe_detail__article-video .play iframe").attr({src:t+e})}),$(".joe_detail__article-video .episodes .item").first().click())},jumpToComment:function(){var e,n,t,a;!ThemeConfig.enable_clean_mode&&ThemeConfig.enable_comment&&"false"!==PageAttrs.metas.enable_comment&&(e=(t=Utils.getUrlParams()).cid,t=t.p,a=void 0===t?"":t,(n=void 0===e?"":e)&&setTimeout(function(){try{var e=document.getElementsByTagName("halo-comment");if(!e)return;var t=$(e[0].shadowRoot.getElementById("halo-comment")).find("#comment-"+n);if(!t)return;var o=t.offset().top-50;window.scrollTo({top:o}),window.history.replaceState(null,null,a?"?p=".concat(a):location.origin+location.pathname)}catch(e){console.error(e)}},1e3))}};document.addEventListener("DOMContentLoaded",function(){Object.keys(t).forEach(function(e){return t[e]()})})})();