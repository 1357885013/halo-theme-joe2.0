const photosContext={initEffect(type){ThemeConfig.enable_photos_effect&&new WOW({boxClass:"wow",animateClass:"grid"===type?"bounceIn":"fadeIn",offset:0,mobile:!0,live:!0}).init()},initList(){const $domList=$(".joe_photos__gallery"),$domEmpty=$(".joe_empty"),$domLoad=$(".joe_load"),queryData={page:0,size:ThemeConfig.photos_page_size,sort:"createTime,desc"};let isLoading=!1,isFirst=!0,isEnd=!1,listData=[],curLayout=ThemeConfig.photos_layout||"grid";let $masonry_instance;const renderList=data=>{"grid"===curLayout?(data=>{if(data){const htmlArr=data.reduce((result,item,index)=>result.concat([`<a class="item animated wow" data-wow-diration="0.3s" data-wow-delay="0.${index}s" data-fancybox="gallery" href="${item.url}">\n        <img width="100%" height="100%" class="lazyloadx" src="${item.thumbnail}" alt="${item.name}"/>\n        <span class="team" style="background-color:${Utils.getRandomColor(.2,.5)}">${item.team}</span>\n        <p class="tit">${item.name}</p>\n        <div class="info">\n          <p class="animated fadeInRightBig"><i class="joe-font joe-icon-paizhao"></i><span>${item.name}</span></p>\n          ${item.location?`<p class="animated fadeInRightBig"><i class="joe-font joe-icon-dingwei"></i><span>${item.location}</span></p>`:""}\n          <p class="animated fadeInRightBig"><i class="joe-font joe-icon-shijian"></i>${Utils.formatDate(item.takeTime)}</p>\n        </div>\n      </a>`]),[]);$domList.append(htmlArr.join(""))}$domList.justifiedGallery({rowHeight:200,maxRowHeight:!1,maxRowsCount:0,sizeRangeSuffixes:{},lastRow:"nojustify",captions:!1,waitThumbnailsLoad:!0,margins:ThemeConfig.photos_gap,extension:/\.(jpe?g|png|gif|bmp|webp)$/,cssAnimation:!1}).on("jg.complete",(function(e){isFirst=!1,isLoading=!1}))})(data):(data=>{Masonry&&imagesLoaded&&(data&&data.forEach((item,index)=>{const $item=$(`<a class="item masonry-item animated wow" style="margin-bottom:${ThemeConfig.photos_gap||"10"}px" data-wow-diration="0.3s" data-wow-delay="0.${index}s" data-fancybox="gallery" href="${item.url}">\n      <img width="100%" height="100%" class="lazyload" rsrc="${ThemeConfig.photo_lazyload_img||ThemeConfig.RES_BASE_URL+"/source/img/lazyload.gif"}" src="${item.thumbnail}" alt="${item.name}"/>\n      <span class="team" style="background-color:${Utils.getRandomColor(.2,.5)}">${item.team}</span>\n      <p class="tit">${item.name}</p>\n      <div class="info">\n        <p class="animated fadeInRightBig"><i class="joe-font joe-icon-paizhao"></i><span>${item.name}</span></p>\n        ${item.location?`<p class="animated fadeInRightBig"><i class="joe-font joe-icon-dingwei"></i><span>${item.location}</span></p>`:""}\n        <p class="animated fadeInRightBig"><i class="joe-font joe-icon-shijian"></i>${Utils.formatDate(item.takeTime)}</p>\n      </div>\n    </a>`);$domList.append($item),$masonry_instance&&$masonry_instance.append($item).masonry("appended",$item)}),$domList.imagesLoaded((function(){$masonry_instance=$domList.masonry({itemSelector:".masonry-item",columnWidth:ThemeConfig.photos_gap,gutter:ThemeConfig.photos_gap,horizontalOrder:!0,percentPosition:!0,initLayout:!0,fitWidth:!0,resize:!0,transitionDuration:"0.2s"}),$masonry_instance.masonry("on","layoutComplete",(function(){console.log("waterfall layout is complete"),isFirst=!1,isLoading=!1}))})))})(data),isFirst&&photosContext.initEffect(curLayout)},getData=param=>new Promise((resolve,reject)=>{isLoading=!0;const params={...queryData,...param||{}};""===params.team&&delete params.team,Utils.request("/api/content/photos","GET",params).then(res=>{const resD=res.content||[];0===resD.length?($domLoad.hide(),0===params.page&&($domList.hide(),$domEmpty.removeClass("hide"))):(renderList(resD),$domEmpty.addClass("hide"),$domList.show(),res.isLast?(isEnd=!0,$domLoad.hide()):(setTimeout(()=>{$domLoad.removeAttr("loading").html("加载更多").show()},500),$domEmpty.addClass("hide"))),listData=params.page>0?listData.concat(resD):resD,resolve(resD)}).catch(err=>{$domList.hide(),$domEmpty.removeClass("hide"),Qmsg.error(err),isLoading=!1,reject(err)})}),reset=param=>{$domList.empty(),isFirst=!0,isEnd=!1,isLoading=!1,queryData.page=0,getData(param)};getData(),window.addEventListener("scroll",Utils.throttle((function(){if($(window).scrollTop()+$(window).height()>=$(".joe_container").height()){if(isLoading)return;if(isEnd)return;queryData.page++,getData({team:$(".joe_photos__filter li.active").attr("data-filter")})}}))),$domLoad.on("click",(function(){$(this).attr("loading")||(queryData.page++,getData({team:$(".joe_photos__filter li.active").attr("data-filter")}))})),$(".joe_photos__filter li").on("click",(function(){const $this=$(this);$this.hasClass("active")||($this.addClass("active").siblings("li").removeClass("active"),reset({team:$this.attr("data-filter")}))})),$(".joe_photos__layout-switch i").on("click",(function(){const $this=$(this);$this.hasClass("active")||(curLayout=$this.attr("data-type"),$this.addClass("active").siblings("i").removeClass("active"),$masonry_instance=null,$domList.attr({class:"",style:""}).attr("class","joe_photos__gallery "+curLayout),reset({team:$(".joe_photos__filter li.active").attr("data-filter")}))}))}};document.addEventListener("DOMContentLoaded",(function(){photosContext.initList()}));