document.addEventListener("DOMContentLoaded",()=>{{const bytesToSize=bytes=>{if(!bytes)return"0 B";const i=Math.floor(Math.log(bytes)/Math.log(1e3));return(bytes/Math.pow(1e3,i)).toPrecision(3)+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][i]},megaknotsToSize=limit=>limit<1024?parseInt(limit)+" MB":parseInt(limit/1024)+" GB",categories=[],upSeries=[],downSeries=[],flowDom=document.querySelector("#flow"),workDom=document.querySelector("#work"),flowChart=flowDom&&echarts.init(flowDom),workChart=workDom&&echarts.init(workDom);flowDom&&workDom&&function initChart(){$.ajax({url:Joe.BASE_API,type:"POST",dataType:"json",data:{routeType:"server_status"},success(res){res.status||Qmsg.warning("服务器接口异常！");{$(".joe_census__server-item .count .core").html(`${res.cpu[1]} 核`),$(".joe_census__server-item .count .ram").html(`${megaknotsToSize(res.memory.memTotal)}`),$(".joe_census__server-item .count .up").html(`总发送：${bytesToSize(res.upTotal)}`),$(".joe_census__server-item .count .down").html(`总接收：${bytesToSize(res.downTotal)}`);const stamp=new Date,time=`${String(stamp.getHours()).padStart(2,0)}:${String(stamp.getMinutes()).padStart(2,0)}:${String(stamp.getSeconds()).padStart(2,0)}`;categories.push(time),upSeries.push(res.up),downSeries.push(res.down),categories.length>5&&categories.shift(),upSeries.length>5&&upSeries.shift(),downSeries.length>5&&downSeries.shift(),flowChart.setOption({title:{subtext:"单位 KB/s"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},xAxis:{axisTick:{show:!1},type:"category",boundaryGap:!1,data:categories},yAxis:{type:"value"},series:[{type:"line",name:"上行",smooth:!0,showSymbol:!1,itemStyle:{normal:{color:"#f39494",areaStyle:{color:"#f39494"},lineStyle:{width:2,color:"#f39494"}}},stack:"总量",data:upSeries},{type:"line",name:"下行",smooth:!0,showSymbol:!1,itemStyle:{normal:{color:"#9dd3e8",areaStyle:{color:"#9dd3e8"},lineStyle:{width:2,color:"#9dd3e8"}}},stack:"总量",data:downSeries}]})}{const cpuUse=res.cpu[0],memoryRealUse=Math.round(res.memory.memRealUsed/res.memory.memTotal*1e3)/10,memoryCacheUse=Math.round(res.memory.memCached/res.memory.memTotal*1e3)/10,memoryBufferUse=Math.round(res.memory.memBuffers/res.memory.memTotal*1e3)/10,systemLoad=Math.round(res.load.one/res.load.max*100)>100?100:Math.round(res.load.one/res.load.max*100);workChart.setOption({title:{subtext:"单位 百分比"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"3%",bottom:"3%",containLabel:!0},xAxis:{type:"category",axisTick:{show:!1},data:["CPU占用","内存占用","系统缓冲","内存缓冲","系统负载"]},yAxis:{type:"value",max:100},series:{data:[{name:"CPU占用",value:cpuUse,itemStyle:{color:"#b3c25a"}},{name:"内存占用",value:memoryRealUse,itemStyle:{color:"#67b580"}},{name:"系统缓冲",value:memoryBufferUse,itemStyle:{color:"#86ba71"}},{name:"内存缓冲",value:memoryCacheUse,itemStyle:{color:"#feb041"}},{name:"系统负载",value:systemLoad,itemStyle:{color:"#fd7e55"}}],type:"bar",showBackground:!0,label:{show:!0,color:"#ffffff",formatter:params=>`${params.data.value}%`},backgroundStyle:{color:"rgba(180, 180, 180, 0.2)"}}})}setTimeout(initChart,2e3)}})}()}{const categoryDom=document.querySelector("#category"),categoryChart=echarts.init(categoryDom),seriesData=[];$(".joe_census__basic-item.category ul li").each((index,item)=>{seriesData.push({name:item.getAttribute("data-name"),value:item.getAttribute("data-value")})}),categoryChart.setOption({tooltip:{trigger:"item"},series:[{type:"pie",roseType:"area",itemStyle:{borderRadius:8},data:seriesData}]})}{const latelyDom=document.querySelector("#lately"),latelyChart=echarts.init(latelyDom);$.ajax({url:Joe.BASE_API,type:"POST",dataType:"json",data:{routeType:"comment_lately"},success(res){latelyChart.setOption({title:{subtext:"单位 数量"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},grid:{left:"3%",right:"3%",bottom:"3%",containLabel:!0},xAxis:{type:"category",axisTick:{show:!1},data:res.categories},yAxis:{type:"value"},series:{name:"数量",itemStyle:{normal:{color:"#91cc75",lineStyle:{width:2,color:"#91cc75"}}},data:res.series,type:"line",smooth:!0}})}})}{let page=0;$(".joe_census__filing .content").on("click",".panel",(function(){const panelBox=$(this).parents(".content");panelBox.find(".panel").not($(this)).removeClass("in"),panelBox.find(".panel-body").not($(this).siblings(".panel-body")).stop().hide("fast"),$(this).toggleClass("in").siblings(".panel-body").stop().toggle("fast")})),$(".joe_census__filing .button").on("click",(function(){"loading..."!==$(".joe_census__filing .button").html()&&$.ajax({url:Joe.BASE_API,type:"POST",dataType:"json",data:{routeType:"article_filing",page:++page},success(res){if(!res.length)return $(".joe_census__filing .item.load").remove(),Qmsg.warning("没有更多内容了");let htmlStr="";res.forEach(item=>{htmlStr+=`\n\t\t\t\t\t\t\t<div class="item">\n\t\t\t\t\t\t\t\t<div class="tail"></div>\n\t\t\t\t\t\t\t\t<div class="head"></div>\n\t\t\t\t\t\t\t\t<div class="wrapper">\n\t\t\t\t\t\t\t\t\t<div class="panel">${item.date}<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M21.6 772.8c28.8 28.8 74.4 28.8 103.2 0L512 385.6l387.2 387.2c28.8 28.8 74.4 28.8 103.2 0 28.8-28.8 28.8-74.4 0-103.2L615.2 282.4l-77.6-77.6c-14.4-14.4-37.6-14.4-51.2 0l-77.6 77.6L21.6 669.6c-28.8 28.8-28.8 75.2 0 103.2z" /></svg></div>\n\t\t\t\t\t\t\t\t\t<ol class="panel-body">\n\t\t\t\t\t\t\t\t\t\t${item.list.map(_=>`<li><a rel="noopener noreferrer" target="_blank" href="${_.permalink}">${_.title}</a></li>`).join("")}\n\t\t\t\t\t\t\t\t\t</ol>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`}),$("#filing").append(htmlStr),$(".joe_census__filing .button").html("加载更多")}}),$(this).html("loading...")}))}});